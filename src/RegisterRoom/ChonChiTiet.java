/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package RegisterRoom;

import View.DKyPhong.dkyphong;
import com.formdev.flatlaf.FlatLightLaf;
import javax.swing.table.DefaultTableModel;
import java.sql.Connection;
import java.sql.SQLException;
import javax.swing.JOptionPane;
import oracle.jdbc.internal.ResultSetCache;
import java.sql.*;
import javax.swing.UIManager;
import com.formdev.flatlaf.FlatLightLaf;
import java.awt.Font;
import javax.swing.JFrame;


/**
 *
 * @author Admin
 */
public class ChonChiTiet extends javax.swing.JFrame {
     private String tenToa ;
     private String loaiPhong ;
     private  String gioiTinh;
     private  String cccd;
    /**
     * Creates new form DangKiPhong
     */
    
public ChonChiTiet() {
        initComponents();
    }
public ChonChiTiet(String tenToa,String loaiPhong, String gioiTinh,String cccd) {
    System.out.println(tenToa);
        this.tenToa=tenToa;
        this.loaiPhong=loaiPhong;
        this.gioiTinh=gioiTinh;
        this.cccd=cccd;
        initComponents();
        jLabel2.setText(tenToa);
        jLabel5.setText(loaiPhong);
        jLabel6.setText(gioiTinh);
        
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        jTextArea1 = new javax.swing.JTextArea();
        jLabel1 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jMenu1 = new javax.swing.JMenu();
        buttonGroup1 = new javax.swing.ButtonGroup();
        menuBar1 = new java.awt.MenuBar();
        menu1 = new java.awt.Menu();
        menu2 = new java.awt.Menu();
        filler1 = new javax.swing.Box.Filler(new java.awt.Dimension(0, 0), new java.awt.Dimension(0, 0), new java.awt.Dimension(32767, 0));
        filler2 = new javax.swing.Box.Filler(new java.awt.Dimension(0, 0), new java.awt.Dimension(0, 0), new java.awt.Dimension(32767, 32767));
        jLabel3 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jButton3 = new javax.swing.JButton();
        jButton4 = new javax.swing.JButton();
        jButton5 = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        jButton6 = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();

        jTextArea1.setColumns(20);
        jTextArea1.setRows(5);
        jTextArea1.setText("THÔNG TIN SINH VIÊN Ở KTX ĐHQG-HCM ĐĂNG KÝ Ở NH 2024 - 2025\n \nĐể đảm bảo thời gian đăng ký ở Ký túc xá trực tuyến, sinh viên chuẩn bị đầy đủ file hình sau:\n* Thẻ căn cước công dân/mã số định danh cá nhân;\n* Thẻ Bảo hiểm Y tế;\n* Giấy tờ minh chứng sinh viên:\n  1. Đối với Tân sinh viên: Làm thủ tục nhập học ở trường trước khi đăng ký ở Ký túc xá (Xem thêm tại đây)\n\n      - Sinh viên các trường thuộc ĐHQG-HCM: Thẻ sinh viên/Giấy biên nhận hồ sơ nhập học/Giấy xác nhận đã nhập học.\n\n      - Sinh viên các trường ngoài ĐHQG-HCM: Giấy xác nhận có đóng dấu của nhà trường.\n\n  2. Đối với sinh viên năm 2 trở lên (Xem thêm tại đây)\n\n      - Sinh viên các trường thuộc ĐHQG-HCM: Thẻ sinh viên/Giấy xác nhận sinh viên/Thời khoá biểu học tập.\n\n      - Sinh viên các trường ngoài ĐHQG-HCM: Giấy xác nhận có đóng dấu của nhà trường.\n\n* Hình ảnh chân dung\n\n      - Lưu ý:\n\nẢnh mới chụp: không quá 6 tháng.\nTỉ lệ ảnh: 4 x 6.\nTỉ lệ diện tích khuôn mặt: chiếm khoảng 75% diện tích ảnh.\nChiều cao từ mắt lên mép trên của ảnh: xấp xỉ 2/3 chiều cao từ mắt xuống mép dưới của ảnh.\nGóc chụp: Mặt nhìn thẳng.\nTrang phục: Đầu để trần, không đeo kính, trang phục gọn gàng lịch sự.\nPhông nền: màu trắng hoặc màu xanh.\nĐịnh dạng file: .jpeg, .png (File ảnh từ điện thoại hoặc từ các thiết bị chụp ảnh kĩ thuật số, Không được chụp lại ảnh thẻ 3x4 hoặc 4x6)\nẢnh gốc: Ảnh được chụp từ điện thoại, không qua các ứng dụng chỉnh sửa ảnh.\nVì ảnh sẽ được sử dụng cho công tác in thẻ và hệ thống nhận diện khuôn mặt (FaceId) tại ký túc xá. Sinh viên sẽ phải hoàn toàn chịu trách nhiệm về việc đăng tải hình ảnh chân dung nếu có sai sót xảy ra.\nSinh viên tìm hiểu kỹ thông tin sau:\n- Thời gian thực hiện đăng ký tối đa 20 phút;\n- Thời gian trả kết quả trong vòng 36 giờ tính từ khi đăng ký thành công.\nVui lòng đọc kỹ thông tin sau:\n1. Danh sách các trường đã ký thoả thuận với Ký túc xá năm học 2024 – 2025.\n\n2. Thời gian ở KTX:\n\n- Thời gian bắt đầu: 01/9/2024.\n\n- Thời gian kết thúc: Sinh viên lựa chọn một trong ba mốc thời gian sau theo kế hoạch học tập của cá nhân:\n\n+ Ngày 30/6/2025;\n\n+ Ngày 31/7/2025;\n\n+ Ngày 31/8/2025 (không dành cho sinh viên năm thứ 4 trở lên).\n\n3. Sinh viên đăng ký ở một học kỳ (từ ngày 01/9/2024 đến 31/01/2025): Trung tâm chỉ xem xét các trường hợp sau:\n\n- Sinh viên có nhu cầu ở cả năm học 2024 - 2025 nhưng chỉ đóng tiền từng học kỳ: Sinh viên có hoàn cảnh khó khăn: Nộp đơn, sổ hộ nghèo/giấy xác nhận gia đình có hoàn cảnh khó khăn (còn thời hạn) hoặc trình bày rõ lý do; các trường hợp đặc biệt khác TTQL KTX&ĐTĐH căn cứ lý do cụ thể để hỗ trợ sinh viên. Sinh viên sắp xếp ở tại phòng cũ, nhà cũ (trong trường hợp thuộc diện chuyển phòng thì tuân thủ theo sự sắp xếp của Ban Quản lý cụm nhà).\n\n- Sinh viên sắp tốt nghiệp: Nộp đơn và minh chứng (thời khoá biểu, lịch học) cho Ban Quản lý cụm nhà. Sinh viên được sắp xếp ở tại nhà E4, KTX Khu B.\n\n- Các trường hợp đặc biệt khác: TTQL KTX&ĐTĐH căn cứ lý do cụ thể để xem xét, giải quyết.\n\n4. Những sinh viên thuộc diện phải làm đơn đăng ký có xác nhận của nhà trường hoặc bản cam kết đối với sinh viên vi phạm nội quy, quy định của Ký túc xá năm học 2023 – 2024 trở về trước, hoàn tất thủ tục theo thông báo trước khi đăng ký (sinh viên tải mẫu đơn tại đây).\n\n5. Sau khi hoàn tất đăng ký, trong vòng 36 giờ, hệ thống sẽ gửi thông báo qua email của sinh viên. Sinh viên đăng nhập vào email đã đăng ký hoặc tài khoản cá nhân trên trang web:  sv.ktxhcm.edu.vn để thực hiện thanh toán online theo hướng dẫn.\n\n5.1. Trường hợp ĐƯỢC duyệt: sinh viên thực hiện thanh toán theo hướng dẫn và trong thời gian 5 ngày kể từ khi được duyệt.\n\n5.2. Trường hợp KHÔNG được duyệt: sinh viên liên hệ Hành chính toà nhà và thực hiện theo hướng dẫn.\n\nTổng đài hỗ trợ: 1900.055.559\n\n1. Phòng Công tác sinh viên: 105\n \n2. Phòng Công nghệ thông tin - Dữ liệu: 114, 115\n\n3. Phòng Kế hoạch tài chính: 112\n\n4. Ban quản lý các cụm nhà: AF: 120, AG: 121, AH: 122, BA: 123, BB: 124, BC: 125, BD: 126, BE: 1");
        jScrollPane1.setViewportView(jTextArea1);

        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/nhaden.png"))); // NOI18N

        jLabel4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/redrac.png"))); // NOI18N

        jMenu1.setText("jMenu1");

        menu1.setLabel("File");
        menuBar1.add(menu1);

        menu2.setLabel("Edit");
        menuBar1.add(menu2);

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());
        getContentPane().add(filler1, new org.netbeans.lib.awtextra.AbsoluteConstraints(724, 341, -1, -1));
        getContentPane().add(filler2, new org.netbeans.lib.awtextra.AbsoluteConstraints(724, 347, -1, -1));
        getContentPane().add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(1500, 535, 37, -1));

        jPanel1.setBackground(new java.awt.Color(153, 204, 255));
        jPanel1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jButton1.setText("Tầng 1");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jButton2.setText("Tầng 2");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        jButton3.setText("Tầng 3");
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });

        jButton4.setText("Tầng 4");
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });

        jButton5.setText("Tầng 5");
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {"A1", "Phòng dịch vụ 6 sinh viên", "3", "P123", "2"},
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null}
            },
            new String [] {
                "Tòa", "Loại phòng", "Tầng", "Phòng", "Số chỗ còn trống"
            }
        ));
        jTable1.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        jTable1.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jScrollPane2.setViewportView(jTable1);

        jButton6.setText("Đăng kí");
        jButton6.setActionCommand("");
        jButton6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton6ActionPerformed(evt);
            }
        });

        jLabel2.setText("jLabel2");
        jLabel2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jLabel5.setText("jLabel5");
        jLabel5.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jLabel6.setText("jLabel6");
        jLabel6.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(280, 280, 280)
                        .addComponent(jButton6, javax.swing.GroupLayout.PREFERRED_SIZE, 152, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGap(57, 57, 57)
                                .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 121, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(32, 32, 32)
                                .addComponent(jLabel5, javax.swing.GroupLayout.PREFERRED_SIZE, 237, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel1Layout.createSequentialGroup()
                                .addGap(27, 27, 27)
                                .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 94, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(63, 63, 63)
                                .addComponent(jButton2, javax.swing.GroupLayout.PREFERRED_SIZE, 102, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(64, 64, 64)
                                .addComponent(jButton3, javax.swing.GroupLayout.PREFERRED_SIZE, 97, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGap(48, 48, 48)
                                .addComponent(jButton4, javax.swing.GroupLayout.PREFERRED_SIZE, 94, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(30, 30, 30)
                                .addComponent(jButton5, javax.swing.GroupLayout.PREFERRED_SIZE, 94, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGap(34, 34, 34)
                                .addComponent(jLabel6, javax.swing.GroupLayout.PREFERRED_SIZE, 134, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                .addContainerGap(594, Short.MAX_VALUE))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addGap(0, 6, Short.MAX_VALUE)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 800, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(501, 501, 501))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(14, 14, 14)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel5, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(32, 32, 32)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jButton2, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jButton3, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jButton4, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jButton5, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(33, 33, 33)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 259, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(40, 40, 40)
                .addComponent(jButton6, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(93, Short.MAX_VALUE))
        );

        getContentPane().add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1160, 600));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        // TODO add your handling code here:
        DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
    model.setRowCount(0); // Xoá dữ liệu cũ
    

    try (Connection conn = ConnectDB.ConnectionUtils.getMyConnectionOracle()) {
        String sql = "SELECT * FROM phong p, toa t\n" +
"WHERE P.matoa=T.matoa AND P.loaiphong=? AND T.tentoa=? and p.tang=2"; // tuỳ tên bảng bạn dùng
        
        PreparedStatement stmt = conn.prepareStatement(sql);
        stmt.setString(1,this.loaiPhong);
        stmt.setString(2, this.tenToa);
        ResultSet rs = stmt.executeQuery();
       
        while (rs.next()) {
            String toa =this.tenToa;
            String loaiPhong =this.loaiPhong;
            int tang =2;
            String phong = rs.getString("maphong");
            int sucChua = rs.getInt("succhua");
            String query = "SELECT COUNT(s.masv)\n as songuoi " +
"FROM phong p, sinhvien s\n" +
"WHERE P.maphong=s.maphong AND p.maphong=?\n" +
"GROUP BY P.maphong";
    PreparedStatement stmt1 = conn.prepareStatement(query);
    stmt1.setString(1,phong);
    ResultSet rs1 = stmt1.executeQuery();
    int soNguoi=0;
    if (rs1.next()) {
     soNguoi = rs1.getInt("songuoi");  // phải viết đúng tên cột là "songuoi"
}
            System.out.println(soNguoi);
    int choTrong=sucChua-soNguoi;
            model.addRow(new Object[]{toa, loaiPhong, tang, phong, choTrong});
        }

    } catch (SQLException | ClassNotFoundException ex) {
        ex.printStackTrace();
        JOptionPane.showMessageDialog(this, "Lỗi khi tải dữ liệu: " + ex.getMessage());
    }
    }//GEN-LAST:event_jButton2ActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
            DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
    model.setRowCount(0); // Xoá dữ liệu cũ
    

    try (Connection conn = ConnectDB.ConnectionUtils.getMyConnectionOracle()) {
        String sql = "SELECT * FROM phong p, toa t\n" +
"WHERE P.matoa=T.matoa AND P.loaiphong=? AND T.tentoa=? and p.tang=1"; // tuỳ tên bảng bạn dùng
        
        PreparedStatement stmt = conn.prepareStatement(sql);
        stmt.setString(1,this.loaiPhong);
        stmt.setString(2, this.tenToa);
        ResultSet rs = stmt.executeQuery();
       
        while (rs.next()) {
            String toa =this.tenToa;
            String loaiPhong =this.loaiPhong;
            int tang =1;
            String phong = rs.getString("maphong");
            int sucChua = rs.getInt("succhua");
            String query = "SELECT COUNT(s.masv)\n as songuoi " +
"FROM phong p, sinhvien s\n" +
"WHERE P.maphong=s.maphong AND p.maphong=?\n" +
"GROUP BY P.maphong";
    PreparedStatement stmt1 = conn.prepareStatement(query);
    stmt1.setString(1,phong);
    ResultSet rs1 = stmt1.executeQuery();
    int soNguoi=0;
    if (rs1.next()) {
     soNguoi = rs1.getInt("songuoi");  // phải viết đúng tên cột là "songuoi"
}
            System.out.println(soNguoi);
    int choTrong=sucChua-soNguoi;
            model.addRow(new Object[]{toa, loaiPhong, tang, phong, choTrong});
        }

    } catch (SQLException | ClassNotFoundException ex) {
        ex.printStackTrace();
        JOptionPane.showMessageDialog(this, "Lỗi khi tải dữ liệu: " + ex.getMessage());
    }
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
        DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
    model.setRowCount(0); // Xoá dữ liệu cũ
    

    try (Connection conn = ConnectDB.ConnectionUtils.getMyConnectionOracle()) {
        String sql = "SELECT * FROM phong p, toa t\n" +
"WHERE P.matoa=T.matoa AND P.loaiphong=? AND T.tentoa=? and p.tang=5"; // tuỳ tên bảng bạn dùng
        
        PreparedStatement stmt = conn.prepareStatement(sql);
        stmt.setString(1,this.loaiPhong);
        stmt.setString(2, this.tenToa);
        ResultSet rs = stmt.executeQuery();
       
        while (rs.next()) {
            String toa =this.tenToa;
            String loaiPhong =this.loaiPhong;
            int tang =5;
            String phong = rs.getString("maphong");
            int sucChua = rs.getInt("succhua");
            String query = "SELECT COUNT(s.masv)\n as songuoi " +
"FROM phong p, sinhvien s\n" +
"WHERE P.maphong=s.maphong AND p.maphong=?\n" +
"GROUP BY P.maphong";
    PreparedStatement stmt1 = conn.prepareStatement(query);
    stmt1.setString(1,phong);
    ResultSet rs1 = stmt1.executeQuery();
    int soNguoi=0;
    if (rs1.next()) {
     soNguoi = rs1.getInt("songuoi");  // phải viết đúng tên cột là "songuoi"
}
            System.out.println(soNguoi);
    int choTrong=sucChua-soNguoi;
            model.addRow(new Object[]{toa, loaiPhong, tang, phong, choTrong});
        }

    } catch (SQLException | ClassNotFoundException ex) {
        ex.printStackTrace();
        JOptionPane.showMessageDialog(this, "Lỗi khi tải dữ liệu: " + ex.getMessage());
    }
    }//GEN-LAST:event_jButton5ActionPerformed

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
        DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
    model.setRowCount(0); // Xoá dữ liệu cũ
    

    try (Connection conn = ConnectDB.ConnectionUtils.getMyConnectionOracle()) {
        String sql = "SELECT * FROM phong p, toa t\n" +
"WHERE P.matoa=T.matoa AND P.loaiphong=? AND T.tentoa=? and p.tang=4"; // tuỳ tên bảng bạn dùng
        
        PreparedStatement stmt = conn.prepareStatement(sql);
        stmt.setString(1,this.loaiPhong);
        stmt.setString(2, this.tenToa);
        ResultSet rs = stmt.executeQuery();
       
        while (rs.next()) {
            String toa =this.tenToa;
            String loaiPhong =this.loaiPhong;
            int tang =4;
            String phong = rs.getString("maphong");
            int sucChua = rs.getInt("succhua");
            String query = "SELECT COUNT(s.masv)\n as songuoi " +
"FROM phong p, sinhvien s\n" +
"WHERE P.maphong=s.maphong AND p.maphong=?\n" +
"GROUP BY P.maphong";
    PreparedStatement stmt1 = conn.prepareStatement(query);
    stmt1.setString(1,phong);
    ResultSet rs1 = stmt1.executeQuery();
    int soNguoi=0;
    if (rs1.next()) {
     soNguoi = rs1.getInt("songuoi");  // phải viết đúng tên cột là "songuoi"
}
            System.out.println(soNguoi);
    int choTrong=sucChua-soNguoi;
            model.addRow(new Object[]{toa, loaiPhong, tang, phong, choTrong});
        }

    } catch (SQLException | ClassNotFoundException ex) {
        ex.printStackTrace();
        JOptionPane.showMessageDialog(this, "Lỗi khi tải dữ liệu: " + ex.getMessage());
    }
    }//GEN-LAST:event_jButton4ActionPerformed

    private void jButton6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton6ActionPerformed
        
        
        
        int selectedRow = jTable1.getSelectedRow();
    
        if (selectedRow == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn phòng để đăng ký!");
            return;
        }
    
    // Lấy dữ liệu từ 5 cột của hàng được chọn
        String toa = jTable1.getValueAt(selectedRow, 0).toString();       // Cột 1: Tòa
        String loaiPhong = jTable1.getValueAt(selectedRow, 1).toString(); // Cột 2: Loại phòng
        int tang = (int) jTable1.getValueAt(selectedRow, 2);      // Cột 3: Tầng
        String phong = jTable1.getValueAt(selectedRow, 3).toString();      // Cột 4: Phòng
        int choTrong = (int) jTable1.getValueAt(selectedRow, 4);   // Cột 5: Số chỗ trống
        
        
        System.out.println("day la cccd "+this.cccd);
        dkyphong dkFrame=new dkyphong(toa,loaiPhong,tang,phong,choTrong,this.cccd);
        dkFrame.setVisible(true);
        dkFrame.setLocationRelativeTo(null);
        
        this.dispose();
    }//GEN-LAST:event_jButton6ActionPerformed

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
        // TODO add your handling code here:
        DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
    model.setRowCount(0); // Xoá dữ liệu cũ
    

    try (Connection conn = ConnectDB.ConnectionUtils.getMyConnectionOracle()) {
        String sql = "SELECT * FROM phong p, toa t\n" +
"WHERE P.matoa=T.matoa AND P.loaiphong=? AND T.tentoa=? and p.tang=3"; // tuỳ tên bảng bạn dùng
        
        PreparedStatement stmt = conn.prepareStatement(sql);
        stmt.setString(1,this.loaiPhong);
        stmt.setString(2, this.tenToa);
        ResultSet rs = stmt.executeQuery();
       
        while (rs.next()) {
            String toa =this.tenToa;
            String loaiPhong =this.loaiPhong;
            int tang =3;
            String phong = rs.getString("maphong");
            int sucChua = rs.getInt("succhua");
            String query = "SELECT COUNT(s.masv)\n as songuoi " +
"FROM phong p, sinhvien s\n" +
"WHERE P.maphong=s.maphong AND p.maphong=?\n" +
"GROUP BY P.maphong";
    PreparedStatement stmt1 = conn.prepareStatement(query);
    stmt1.setString(1,phong);
    ResultSet rs1 = stmt1.executeQuery();
    int soNguoi=0;
    if (rs1.next()) {
     soNguoi = rs1.getInt("songuoi");  // phải viết đúng tên cột là "songuoi"
}
            System.out.println(soNguoi);
    int choTrong=sucChua-soNguoi;
            model.addRow(new Object[]{toa, loaiPhong, tang, phong, choTrong});
        }

    } catch (SQLException | ClassNotFoundException ex) {
        ex.printStackTrace();
        JOptionPane.showMessageDialog(this, "Lỗi khi tải dữ liệu: " + ex.getMessage());
    }
    }//GEN-LAST:event_jButton3ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(ChonChiTiet.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(ChonChiTiet.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(ChonChiTiet.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(ChonChiTiet.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>
        try {
            // Cài theme FlatLaf sáng
            UIManager.setLookAndFeel(new FlatLightLaf());
            UIManager.setLookAndFeel(new FlatLightLaf());
            UIManager.put("Button.arc", 10);
            UIManager.put("Component.arc", 10);
            UIManager.put("TextComponent.arc", 5);
        } catch (Exception ex) {
            System.err.println("Không thể cài FlatLaf");
        }

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                JFrame newChonChiTietFrame=new ChonChiTiet();
                newChonChiTietFrame.setSize(1000, 600);
                newChonChiTietFrame.setLocationRelativeTo(null);
                newChonChiTietFrame.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.Box.Filler filler1;
    private javax.swing.Box.Filler filler2;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton5;
    private javax.swing.JButton jButton6;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JMenu jMenu1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTable jTable1;
    private javax.swing.JTextArea jTextArea1;
    private java.awt.Menu menu1;
    private java.awt.Menu menu2;
    private java.awt.MenuBar menuBar1;
    // End of variables declaration//GEN-END:variables
}
